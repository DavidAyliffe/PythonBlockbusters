{% extends "base.html" %}
{% block title %}{{ title }} - Blockbusters{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3>{{ icon }} {{ title }}</h3>
    <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-1"></i>Back to Dashboard</a>
</div>

{% if view == 'today_revenue' %}
<div class="card mb-3">
    <div class="card-body py-2 d-flex justify-content-between">
        <span class="text-secondary">Total</span>
        <span class="fw-bold fs-5">${{ "%.2f"|format(total) }}</span>
    </div>
</div>
{% endif %}

<div class="table-scroll">
    <table class="table table-hover">
        <thead class="table-dark sticky-top">
            {% if view == 'today_revenue' %}
            <tr>
                <th>Payment ID</th>
                <th>Customer</th>
                <th>Film</th>
                <th>Amount</th>
                <th>Payment Date</th>
            </tr>
            {% else %}
            <tr>
                <th>Rental ID</th>
                <th>Film</th>
                <th>Customer</th>
                <th>Store</th>
                <th>Rented</th>
                {% if view == 'overdue' %}
                <th>Due Date</th>
                <th>Days Overdue</th>
                {% elif view == 'active' %}
                <th>Due Date</th>
                {% else %}
                <th>Returned</th>
                {% endif %}
                <th>Status</th>
            </tr>
            {% endif %}
        </thead>
        <tbody>
            {% if view == 'today_revenue' %}
                {% for r in rows %}
                <tr>
                    <td>{{ r.payment_id }}</td>
                    <td>{{ r.customer_name }}</td>
                    <td><a href="{{ url_for('films.detail', film_id=r.film_id) }}">{{ r.title }}</a></td>
                    <td>${{ "%.2f"|format(r.amount) }}</td>
                    <td>{{ r.payment_date.strftime('%Y-%m-%d %H:%M') if r.payment_date else '-' }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center text-secondary">No payments found for today.</td></tr>
                {% endfor %}
            {% else %}
                {% for r in rows %}
                <tr>
                    <td>{{ r.rental_id }}</td>
                    <td><a href="{{ url_for('films.detail', film_id=r.film_id) }}">{{ r.title }}</a></td>
                    <td>{{ r.customer_name }}</td>
                    <td>Store {{ r.store_id }}</td>
                    <td>{{ r.rental_date.strftime('%Y-%m-%d %H:%M') if r.rental_date else '-' }}</td>
                    {% if view == 'overdue' %}
                    <td>{{ r.due_date.strftime('%Y-%m-%d') if r.due_date else '-' }}</td>
                    <td><span class="badge bg-danger">{{ r.days_overdue }} days</span></td>
                    {% elif view == 'active' %}
                    <td>{{ r.due_date.strftime('%Y-%m-%d') if r.due_date else '-' }}</td>
                    {% else %}
                    <td>{{ r.returned_date.strftime('%Y-%m-%d %H:%M') if r.returned_date else '-' }}</td>
                    {% endif %}
                    <td>
                        {% if view == 'overdue' %}
                        <span class="badge bg-danger">‚ö†Ô∏è Overdue</span>
                        {% elif view == 'active' %}
                        <span class="badge bg-warning text-dark">üîÑ Active</span>
                        {% elif r.returned_date %}
                        <span class="badge bg-success">‚úÖ Returned</span>
                        {% else %}
                        <span class="badge bg-warning text-dark">üîÑ Active</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="8" class="text-center text-secondary">No rentals found.</td></tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
